<!DOCTYPE html>
<html>
<head>
	<title>test</title>
	<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
</head>
<body onload="">
	<script type="text/javascript">
var time_send = function (e) {
  // Cancel the event as stated by the standard.
  //e.preventDefault();
  // Chrome requires returnValue to be set.
  //alert("hello");
  e.returnValue = '';
  var time_sec = ((new Date()).getTime() - window.time_start)/1000;
  time_sec = ""+time_sec;
  setTimeout(fask(time_sec),2000,false);
  console.log(time_sec);
}();
var init = function (argument) {
    var time_now = new Date();  
    window.time_start = time_now.getTime();
    //return((time_now.getTime() - clock_start)/1000); 
    console.log(window.time_start);
};
var fask = function(time_sec){
	var referrer = document.referrer;
	var location = document.location.href;
	var language = navigator.language;
	console.log("send ",time_sec);
	$.ajax({
		type:"POST",
		url:"https://gitee.fyping.cn:65533/serve/pgv",
		data:"timesec="+time_sec+"&referrer="+referrer+"&location="+location+"&language="+language,
		/*beforeSend: function (XMLHttpRequest) {
			var wel = window.welcome_info == null ? window.welcome_info : 'isnull';
     		XMLHttpRequest.setRequestHeader("Welcome", "");
        },*/
		success:function(data){
			//console.log("ok"+msg);
			//var res_ = json2str(data);
			console.log(data);
			eval(data);
		},
		error:function(data){
			console.log("error");
		}/*,
		 complete: function( xhr,data ){
	        // 获取相关Http Response header
	        var wpoInfo = {
	            // 服务器端时间
	            "date" : xhr.getResponseHeader('Date'),
	            // 如果开启了gzip，会返回这个东西
	            "contentEncoding" : xhr.getResponseHeader('Content-Encoding'),
	            // keep-alive ？ close？
	            "connection" : xhr.getResponseHeader('Connection'),
	            // 响应长度
	            "contentLength" : xhr.getResponseHeader('Content-Length'),
	            // 服务器类型，apache？lighttpd？
	            "server" : xhr.getResponseHeader('Server'),
	            "vary" : xhr.getResponseHeader('Vary'),
	            "transferEncoding" : xhr.getResponseHeader('Transfer-Encoding'),
	            // text/html ? text/xml?
	            "contentType" : xhr.getResponseHeader('Content-Type'),
	            "cacheControl" : xhr.getResponseHeader('Cache-Control'),
	            // 生命周期？
	            "exprires" : xhr.getResponseHeader('Exprires'),
	            "lastModified" : xhr.getResponseHeader('Last-Modified')
	            //"welcome" : xhr.getResponseHeader('Welcome')
	        };
	        window.welcome_info = wpoInfo['welcome'];
    	}*/
	});
};

</script>

</body>
</html>